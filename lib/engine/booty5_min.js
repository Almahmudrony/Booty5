/**
 * author       Mat Hopwood
 * copyright    2014 Mat Hopwood
 * More info    http://booty5.com
 */
"use strict";function Actor(a){this.type=Actor.Type_Image;this.scene=null;this.parent=null;this.actors=[];this.removals=[];this.joints=[];this.timelines=new TimelineManager();this.frame_count=0;this.accum_scale_x=1;this.accum_scale_y=1;this.accum_opacity=1;this.body=null;this.transform=[];this.transform_dirty=true;this.touching=false;this.touchmove=false;this.layer=0;this.order_changed=true;this.cache_canvas=null;this.name="";this.tag="";this.id=-1;this.active=true;this.visible=true;this.touchable=false;this.layer=0;this.x=0;this.y=0;this.w=0;this.h=0;this.ox=0;this.oy=0;this.absolute_origin=true;this.rotation=0;this.scale_x=1;this.scale_y=1;this.depth=0;this.opacity=1;this.use_parent_opacity=true;this.current_frame=0;this.frame_speed=0;this.anim_frames=null;this.bitmap=null;this.atlas=null;this.vr=0;this.vx=0;this.vy=0;this.vd=0;this.vr_damping=1;this.vx_damping=1;this.vy_damping=1;this.vd_damping=1;this.ignore_camera=false;this.wrap_position=false;this.dock_x=0;this.dock_y=0;this.margin=[0,0,0,0];this.bubbling=false;this.clip_children=false;this.clip_margin=[0,0,0,0];this.clip_shape=null;this.self_clip=false;this.orphaned=false;this.virtual=false;this.shadow=false;this.shadow_x=0;this.shadow_y=0;this.shadow_blur=0;this.shadow_colour="#000000";this.composite_op=null;this.cache=false;this.merge_cache=false;if(a==true){this.makeVirtual()}}Actor.Dock_None=0;Actor.Dock_Top=1;Actor.Dock_Bottom=2;Actor.Dock_Left=1;Actor.Dock_Right=2;Actor.Type_Image=0;Actor.Type_Label=1;Actor.Type_Rect=2;Actor.Type_Arc=3;Actor.Type_Polygon=4;Actor.Type_Particle=5;Object.defineProperty(Actor.prototype,"_x",{get:function(){return this.x},set:function(a){if(this.x!=a){this.x=a;this.dirty()}}});Object.defineProperty(Actor.prototype,"_y",{get:function(){return this.y},set:function(a){if(this.y!=a){this.y=a;this.dirty()}}});Object.defineProperty(Actor.prototype,"_ox",{get:function(){return this.ox},set:function(a){if(this.ox!=a){this.ox=a;this.dirty()}}});Object.defineProperty(Actor.prototype,"_oy",{get:function(){return this.oy},set:function(a){if(this.oy!=a){this.oy=a;this.dirty()}}});Object.defineProperty(Actor.prototype,"_rotation",{get:function(){return this.rotation},set:function(a){if(this.rotation!=a){this.rotation=a;this.dirty()}}});Object.defineProperty(Actor.prototype,"_scale_x",{get:function(){return this.scale_x},set:function(a){if(this.scale_x!=a){this.scale_x=a;this.dirty()}}});Object.defineProperty(Actor.prototype,"_scale_y",{get:function(){return this.scale_y},set:function(a){if(this.scale_y!=a){this.scale_y=a;this.dirty()}}});Object.defineProperty(Actor.prototype,"_scale",{set:function(a){this._scale_x=a;this._scale_y=a}});Object.defineProperty(Actor.prototype,"_depth",{get:function(){return this.depth},set:function(a){if(this.depth!=a){this.depth=a;this.dirty()}}});Object.defineProperty(Actor.prototype,"_layer",{get:function(){return this.layer},set:function(a){if(this.layer!=a){this.layer=a;if(this.parent!=null){this.parent.order_changed=true}else{this.scene.order_changed=true}}}});Actor.prototype.setPosition=function(a,b){if(this.x!=a||this.y!=b){this.x=a;this.y=b;this.dirty()}};Actor.prototype.setPositionPhysics=function(a,d){if(this.body!=null){this.x=a;this.y=d;this.dirty();var c=Box2D.Common.Math.b2Vec2;var b=this.scene.world_scale;this.body.SetPosition(new c(a/b,d/b))}};Actor.prototype.setOrigin=function(a,b){if(this.ox!=a||this.oy!=b){this.ox=a;this.oy=b;this.dirty()}};Actor.prototype.setScale=function(a,b){if(this.scale_x!=a||this.scale_y!=b){this.scale_x=a;this.scale_y=b;this.dirty()}};Actor.prototype.setRotation=function(a){if(this.rotation!=a){this.rotation=a;this.dirty();if(this.body!=null){this.body.SetAngle(a)}}};Actor.prototype.setRotationPhysics=function(a){if(this.body!=null){this.rotation=a;this.dirty();this.body.SetAngle(a)}};Actor.prototype.setDepth=function(a){if(this.depth!=a){this.depth=a;this.dirty()}};Actor.prototype.release=function(){if(this.onDestroy!==undefined){this.onDestroy()}this.releaseJoints();this.releaseBody()};Actor.prototype.destroy=function(){if(this.parent!=null){this.parent.removeActor(this)}else{if(this.scene!=null){this.scene.removeActor(this)}}};Actor.prototype.changeParent=function(c){var a;if(this.parent!=null){a=this.parent.actors}else{a=this.scene.actors}var d=a.length;for(var b=0;b<d;b++){if(this==a[b]){a.splice(b,1);c.addActor(this);break}}};Actor.prototype.addActor=function(a){this.actors.push(a);a.parent=this;a.scene=this.scene;return a};Actor.prototype.removeActor=function(a){this.removals.push(a)};Actor.prototype.removeActorsWithTag=function(a){var b=this.actors;var e=b.length;var d=this.removals;for(var c=0;c<e;c++){if(b[c].tag==a){d.push(b[c])}}};Actor.prototype.cleanupDestroyedActors=function(){var f=this.removals.length;if(f>0){var d=this.removals;var a=this.actors;var e=a.length;for(var c=0;c<f;c++){var g=d[c];for(var b=0;b<e;b++){if(g==a[b]){g.release();a.splice(b,1);e--;break}}}}this.removals=[]};Actor.prototype.findActor=function(d,c){if(c==undefined){c=false}var b=this.actors;var f=b.length;for(var e=0;e<f;e++){if(b[e].name==d){return b[e]}else{if(c){var a=b[e].findActor(d,c);if(a!=null){return a}}}}return null};Actor.prototype.findFirstParent=function(){var a=this;while(a!==null){if(a.parent===null){return a}a=a.parent}return null};Actor.prototype.findFirstCachedParent=function(){var a=this.parent;while(a!==null){if(a.cache_canvas!==null){return a}a=a.parent}return null};Actor.prototype.updateParentTransforms=function(){var a=[];var c=this;while(c!==null){a.push(c);c=c.parent}for(var b=a.length-1;b>=0;b--){a[b].updateTransform()}};Actor.prototype.bringToFront=function(){var a;if(this.parent!=null){a=this.parent.actors}else{a=this.scene.actors}var d=a.length;var c=-1;for(var b=0;b<d;b++){if(a[b]==this){c=b;break}}if(c>=0){a.splice(c,1);a.push(this)}};Actor.prototype.sendToBack=function(){var a;if(this.parent!=null){a=this.parent.actors}else{a=this.scene.actors}var d=a.length;var c=-1;for(var b=0;b<d;b++){if(a[b]==this){c=b;break}}if(c>=0){a.splice(c,1);a.unshift(this)}};Actor.prototype.onBeginTouchBase=function(a){this.touching=true;if(this.bubbling&&this.parent!=null){this.parent.onBeginTouchBase(a)}if(this.onBeginTouch!==undefined){this.onBeginTouch(a)}};Actor.prototype.onEndTouchBase=function(a){if(this.touching&&this.onTapped!==undefined){this.onTapped(a)}this.touching=false;this.touchmove=false;if(this.bubbling&&this.parent!=null){this.parent.onEndTouchBase(a)}if(this.onEndTouch!==undefined){this.onEndTouch(a)}};Actor.prototype.onMoveTouchBase=function(a){this.touchmove=true;if(this.bubbling&&this.parent!=null){this.parent.onMoveTouchBase(a)}if(this.virtual){this.Virtual_onMoveTouch(a)}if(this.onMoveTouch!==undefined){this.onMoveTouch(a)}};Actor.prototype.releaseBody=function(){if(this.body!=null){this.scene.world.DestroyBody(this.body);this.body=null}};Actor.prototype.releaseJoints=function(){if(this.body!=null){for(var a=0;a<this.joints.length;a++){this.scene.world.DestroyJoint(this.joints[a])}this.joints=null}};Actor.prototype.initBody=function(c,d,a){if(!this.scene.app.box2d){return}var e=this.scene;var f=new Box2D.Dynamics.b2BodyDef;var b=e.world_scale;if(c=="static"){f.type=Box2D.Dynamics.b2Body.b2_staticBody}else{if(c=="kinematic"){f.type=Box2D.Dynamics.b2Body.b2_kinematicBody}else{f.type=Box2D.Dynamics.b2Body.b2_dynamicBody}}f.position.Set(this.x/b,this.y/b);f.angle=this.rotation;f.fixedRotation=d;f.bullet=a;this.body=e.world.CreateBody(f);this.body.SetUserData(this)};Actor.prototype.addFixture=function(j){if(this.body==null){return null}var b;var d=this.scene.world_scale;if(j.type==Shape.TypeBox){b=new Box2D.Dynamics.b2FixtureDef;b.shape=new Box2D.Collision.Shapes.b2PolygonShape;b.shape.SetAsBox(j.width/(2*d),j.height/(2*d))}else{if(j.type==Shape.TypeCircle){b=new Box2D.Dynamics.b2FixtureDef;b.shape=new Box2D.Collision.Shapes.b2CircleShape(j.radius/d)}else{if(j.type==Shape.TypePolygon){if(j.convexPoints!==undefined){var a=[];var e=j.convexPoints.length;for(var i=0;i<e;i++){b=new Box2D.Dynamics.b2FixtureDef;b.shape=new Box2D.Collision.Shapes.b2PolygonShape();var g=j.convexPoints[i];var f=[];var c=g.length;for(var h=0;h<c;h+=2){f.push({x:g[h]/d,y:g[h+1]/d})}b.shape.SetAsArray(f,f.length);if(j.density!==undefined){b.density=j.density}if(j.friction!==undefined){b.friction=j.friction}if(j.restitution!==undefined){b.restitution=j.restitution}if(j.is_sensor!==undefined){b.isSensor=j.is_sensor}a.push(this.body.CreateFixture(b))}return a}else{b=new Box2D.Dynamics.b2FixtureDef;b.shape=new Box2D.Collision.Shapes.b2PolygonShape();var g=j.points;var f=[];var c=g.length;for(var h=0;h<c;h+=2){f.push({x:g[h]/d,y:g[h+1]/d})}b.shape.SetAsArray(f,f.length)}}}}if(j.density!==undefined){b.density=j.density}if(j.friction!==undefined){b.friction=j.friction}if(j.restitution!==undefined){b.restitution=j.restitution}if(j.is_sensor!==undefined){b.isSensor=j.is_sensor}return this.body.CreateFixture(b)};Actor.prototype.addJoint=function(o){if(this.body==null){return null}var l;var h=this.scene;var i=h.world;var j=h.world_scale;var k=Box2D.Common.Math.b2Vec2;var g=this.body;var f=o.actor_b.body;var e=g.GetWorldCenter();var a=f.GetWorldCenter();var c=new k(e.x,e.y);c.x+=o.anchor_a.x/j;c.y+=o.anchor_a.y/j;var b=new k(a.x,a.y);b.x+=o.anchor_b.x/j;b.y+=o.anchor_b.y/j;if(o.type=="weld"){l=new Box2D.Dynamics.Joints.b2WeldJointDef;l.Initialize(g,f,c);l.collideConnected=o.self_collide}else{if(o.type=="distance"){l=new Box2D.Dynamics.Joints.b2DistanceJointDef;l.Initialize(g,f,c,b);l.collideConnected=o.self_collide;l.frequencyHz=o.frequency;l.dampingRatio=o.damping}else{if(o.type=="revolute"){l=new Box2D.Dynamics.Joints.b2RevoluteJointDef;l.Initialize(g,f,c);l.collideConnected=o.self_collide;if(o.limit_joint){l.enableLimit=true;l.lowerAngle=o.lower_limit*(Math.PI/180);l.upperAngle=o.upper_limit*(Math.PI/180)}if(o.motor_enabled){l.enableMotor=true;l.motorSpeed=o.motor_speed;l.maxMotorTorque=o.max_motor_torque}}else{if(o.type=="prismatic"){l=new Box2D.Dynamics.Joints.b2PrismaticJointDef;l.Initialize(g,f,c,new k(o.axis.x,o.axis.y));l.collideConnected=o.self_collide;if(o.limit_joint){l.enableLimit=true;l.lowerTranslation=o.lower_limit/j;l.upperTranslation=o.upper_limit/j}if(o.motor_enabled){l.enableMotor=true;l.motorSpeed=o.motor_speed;l.maxMotorForce=o.max_motor_force}}else{if(o.type=="pulley"){var n=new k(e.x,e.y);n.x+=o.ground_a.x/j;n.y+=o.ground_a.y/j;var m=new k(a.x,a.y);m.x+=o.ground_b.x/j;m.y+=o.ground_b.y/j;l=new Box2D.Dynamics.Joints.b2PulleyJointDef;l.Initialize(g,f,n,m,c,b,o.ratio);l.collideConnected=o.self_collide}else{if(o.type=="wheel"){l=new Box2D.Dynamics.Joints.b2LineJointDef;l.Initialize(g,f,c,o.axis);l.collideConnected=o.self_collide;if(o.limit_joint){l.enableLimit=true;l.lowerTranslation=o.lower_limit/j;l.upperTranslation=o.upper_limit/j}if(o.motor_enabled){l.enableMotor=true;l.motorSpeed=o.motor_speed;l.maxMotorForce=o.max_motor_force}}else{if(o.type=="mouse"){l=new Box2D.Dynamics.Joints.b2MouseJointDef;l.collideConnected=o.self_collide;l.bodyA=g;l.bodyB=f;l.collideConnected=o.self_collide;l.maxForce=o.max_motor_force;l.dampingRatio=o.damping}}}}}}}var d=i.CreateJoint(l);this.joints.push(d);return d};Actor.prototype.removeJoint=function(d){var a=this.joints;var c=a.length;for(var b=0;b<c;b++){if(a[b]==d){world.DestroyJoint(d);a.splice(b,1);return}}};Actor.prototype.updateTransform=function(){var l=this.transform;if(this.transform_dirty){var e=this.scene;var a=this.rotation;var h=this.scale_x;var g=this.scale_y;var i=this.parent;if(i==null||this.orphaned){this.accum_scale_x=h;this.accum_scale_y=g}else{this.accum_scale_x=h*i.accum_scale_x;this.accum_scale_y=g*i.accum_scale_y}var j=Math.cos(a);var f=Math.sin(a);if(this.depth!=0&&this.depth!=1){var d=1/this.depth;h*=d;g*=d;l[4]=(this.x-e.camera_x)*d;l[5]=(this.y-e.camera_y)*d}else{this.transform_dirty=false;l[4]=this.x;l[5]=this.y}l[0]=j*h;l[1]=f*h;l[2]=-f*g;l[3]=j*g;var c=this.ox;var b=this.oy;if(c!=0||b!=0){if(!this.absolute_origin){c*=this.w;b*=this.h}l[4]-=c;l[5]-=b;var k=[1,0,0,1,c,b];Maths.preMulMatrix(l,k)}}if(i!=null&&!this.orphaned){Maths.mulMatrix(l,i.transform)}};Actor.prototype.draw=function(){if(!this.visible){return}if(this.cache){this.drawToCache();this.cache=false}if(this.merge_cache){return}var o=this.cache_canvas;var r=this.scene;var j=r.app;var e=j.canvas_scale;var q=j.display;var c=q.context;this.preDraw(c);if(o===null){var i=null;var k=this.atlas;if(k!=null){if(this.anim_frames!=null){i=k.getFrame(this.anim_frames[this.current_frame<<0])}else{i=k.getFrame(this.current_frame<<0)}}}var n=j.canvas_cx+this.scene.x*e;var m=j.canvas_cy+this.scene.y*e;var d=this.w/2;var b=this.h/2;d=(d+0.5)<<0;b=(b+0.5)<<0;if(!this.ignore_camera&&(this.depth==0||this.depth==1)){n-=r.camera_x*e;m-=r.camera_y*e}this.updateTransform();var f=this.transform;var p=this.self_clip;var a=this.clip_children;c.setTransform(f[0]*e,f[1]*e,f[2]*e,f[3]*e,f[4]*e+n,f[5]*e+m);if(p){this.setClipping(c,-d,-b)}if(o===null){if(k!=null){c.drawImage(k.bitmap.image,i.x,i.y,i.w,i.h,-d,-b,this.w+1,this.h+1)}else{if(this.bitmap!=null){c.drawImage(this.bitmap.image,-d,-b,this.w,this.h)}}}else{c.drawImage(o,-o.width>>1,-o.height>>1)}this.postDraw(c);if(a){if(!p){this.setClipping(c,-d,-b)}}else{if(p){c.restore()}}var h=this.actors.length;if(h>0){var g=this.actors;for(var l=0;l<h;l++){g[l].draw()}}if(a){c.restore()}};Actor.prototype.drawToCache=function(){var d=null;var c=0;var b=0;if(this.merge_cache){var f=this.findFirstCachedParent();if(f!==null){d=f.cache_canvas;c=this.x+d.width/2-this.w/2;b=this.y+d.height/2-this.h/2}}if(d===null){d=document.createElement("canvas");d.width=this.w;d.height=this.h}var e=d.getContext("2d");var g=null;var a=this.atlas;if(a!=null){if(this.anim_frames!=null){g=a.getFrame(this.anim_frames[this.current_frame<<0])}else{g=a.getFrame(this.current_frame<<0)}}if(a!=null){e.drawImage(a.bitmap.image,g.x,g.y,g.w,g.h,c,b,this.w,this.h)}else{if(this.bitmap!=null){e.drawImage(this.bitmap.image,c,b,this.w,this.h)}}this.cache_canvas=d};Actor.prototype.preDraw=function(a){if(this.parent==null||!this.use_parent_opacity){this.accum_opacity=this.opacity*this.scene.opacity}else{this.accum_opacity=this.parent.accum_opacity*this.opacity}a.globalAlpha=this.accum_opacity;if(this.shadow){a.shadowOffsetX=this.shadow_x;a.shadowOffsetY=this.shadow_y;a.shadowColor=this.shadow_colour;a.shadowBlur=this.shadow_blur}if(this.composite_op!=null){a.globalCompositeOperation=this.composite_op}};Actor.prototype.postDraw=function(a){if(this.shadow){a.shadowColor="transparent"}if(this.composite_op!=null){a.globalCompositeOperation="source-over"}};Actor.prototype.baseUpdate=function(b){if(!this.active){return false}if(this.onTick!==undefined){this.onTick(b)}this.timelines.update(b);if(this.virtual){this.Virtual_update(b)}var d=this.scene;if(this.atlas!=null){this.current_frame+=this.frame_speed*b;var i;if(this.anim_frames!=null){i=this.anim_frames.length}else{i=this.atlas.getMaxFrames()}while(this.current_frame>=i){this.current_frame-=i}}if(this.body!=null){var g=this.body.GetPosition();var f=d.world_scale;this.setRotation(this.body.GetAngle());this.setPosition(g.x*f,g.y*f)}else{if(this.vr!=0||this.vx!=0||this.vy!=0){this.dirty()}this.rotation+=this.vr*b;this.vr*=this.vr_damping;this.x+=this.vx*b;this.vx*=this.vx_damping;this.y+=this.vy*b;this.vy*=this.vy_damping}if(this.vd!=0){this.depth+=this.vd*b;this.vd*=this.vd_damping}if(this.wrap_position){var c=d.extents[0];var k=(c+d.extents[2]);var h=d.extents[1];var a=(h+d.extents[3]);if(this.x<c){this.x=k}else{if(this.x>k){this.x=c}}if(this.y<h){this.y=a}else{if(this.y>a){this.y=h}}}if(this.parent==null||!this.parent.virtual){if(this.dock_x!=0){if(this.dock_x===Actor.Dock_Left){this.x=-d.w/2+(this.w*this.scale_x)/2+this.margin[0]}else{if(this.dock_x===Actor.Dock_Right){this.x=d.w/2-(this.w*this.scale_x)/2-this.margin[1]}}}if(this.dock_y!=0){if(this.dock_y===Actor.Dock_Top){this.y=-d.h/2+(this.h*this.scale_y)/2+this.margin[2]}else{if(this.dock_y===Actor.Dock_Bottom){this.y=d.h/2-(this.h*this.scale_y)/2-this.margin[3]}}}}var e=this.actors.length;if(e>0){var j=this.actors;for(var l=0;l<e;l++){j[l].update(b)}}this.cleanupDestroyedActors();if(this.order_changed){this.order_changed=false;Utils.sortLayers(this.actors)}this.frame_count++};Actor.prototype.update=function(a){return this.baseUpdate(a)};Actor.prototype.updateToPhysics=function(){if(this.body==null){return}var a=Box2D.Common.Math.b2Vec2;this.body.SetLinearVelocity(new a(this.vx,this.vy));this.body.SetAngularVelocity(this.vr);this.body.SetAwake(true)};Actor.prototype.dirty=function(){this.transform_dirty=true;var b=this.actors;var d=b.length;for(var c=0;c<d;c++){b[c].dirty()}};Actor.prototype.makeVirtual=function(){this.prev_scroll_pos_x=0;this.prev_scroll_pos_y=0;this.scroll_pos_x=0;this.scroll_pos_y=0;this.scroll_vx=0;this.scroll_vy=0;this.scroll_range=[0,0,0,0];this.virtual=true};Actor.prototype.Virtual_onMoveTouch=function(a){if(this.touching&&(this.scroll_range[2]!=0||this.scroll_range[3]!=0)){var b=this.scene.app;this.prev_scroll_pos_x=this.scroll_pos_x;this.prev_scroll_pos_y=this.scroll_pos_y;this.scroll_vx=b.touch_drag_x;this.scroll_pos_x+=b.touch_drag_x;this.scroll_vy=b.touch_drag_y;this.scroll_pos_y+=b.touch_drag_y;if(this.scroll_vx!=0||this.scroll_vy!=0){this.Virtual_scrollRangeCheck();this.Virtual_updateLayout()}}};Actor.prototype.Virtual_update=function(a){var b=false;if(!this.touching){this.prev_scroll_pos_x=this.scroll_pos_x;this.prev_scroll_pos_y=this.scroll_pos_y;this.scroll_pos_x+=this.scroll_vx;this.scroll_pos_y+=this.scroll_vy;if(this.scroll_vx!=0||this.scroll_vy!=0){this.Virtual_scrollRangeCheck();this.Virtual_updateLayout()}this.scroll_vx*=0.9;this.scroll_vy*=0.9;if(this.scroll_vx>-0.5&&this.scroll_vx<0.5){this.scroll_vx=0}if(this.scroll_vy>-0.5&&this.scroll_vy<0.5){this.scroll_vy=0}}if(this.frame_count==0){this.Virtual_updateLayout()}};Actor.prototype.Virtual_scrollRangeCheck=function(){var a=this.scroll_pos_x;var f=this.scroll_pos_y;var e=-this.scroll_range[0];var c=e-this.scroll_range[2];var d=-this.scroll_range[1];var b=d-this.scroll_range[3];if(a<c){a=c;this.scroll_vx=0}else{if(a>e){a=e;this.scroll_vx=0}}if(f<b){f=b;this.scroll_vy=0}else{if(f>d){f=d;this.scroll_vy=0}}this.scroll_pos_x=a;this.scroll_pos_y=f};Actor.prototype.Virtual_updateLayout=function(a){var j=this.prev_scroll_pos_x-this.scroll_pos_x;var i=this.prev_scroll_pos_y-this.scroll_pos_y;var c=this.actors.length;var e=this.w*this.scale_x/2;var b=this.h*this.scale_y/2;if(c>0){var d;var f=this.actors;for(var g=0;g<c;g++){d=f[g];if(d.dock_x!=0){if(d.dock_x==Actor.Dock_Left){d.x=-e+d.w*d.scale_x/2+d.margin[0]}else{if(d.dock_x==Actor.Dock_Right){d.x=e-d.w*d.scale_x/2-d.margin[1]}}}else{d.x+=j}if(d.dock_y!=0){if(d.dock_y==Actor.Dock_Top){d.y=-b+d.h*d.scale_y/2+d.margin[2]}else{if(d.dock_y==Actor.Dock_Bottom){d.y=b-d.h*d.scale_y/2-d.margin[3]}}}else{d.y+=i}d.dirty()}}};Actor.prototype.hitTest=function(g){if(!this.touchable){return null}var h=this.actors.length;var i;if(h>0){var o=this.actors;for(var p=0;p<h;p++){i=o[p].hitTest(g);if(i!=null){return i}}}var f=this.scene;var q=this.transform;var c=q[4]+f.x;var b=q[5]+f.y;if(!this.ignore_camera){c-=f.camera_x;b-=f.camera_y}var m=this.accum_scale_x;var k=this.accum_scale_y;var n=(g.x-c)/m;var l=(g.y-b)/k;var e=n*q[0]+l*q[1];var d=n*q[2]+l*q[3];var j=(this.w*m)/2;var a=(this.h*k)/2;if(e>=-j&&e<=j&&d>=-a&&d<=a){return this}return null};Actor.prototype.transformPoint=function(a,b){return Maths.vecMulMatrix(a,b,this.transform)};Actor.prototype.setClipping=function(a,h,g){a.save();a.beginPath();var e=this.clip_margin;var d=this.clip_shape;if(d==null){var f=this.type;if(f==Actor.Type_Arc){a.arc(0,0,this.radius,0,2*Math.PI)}else{if(f==Actor.Type_Polygon){a.beginPath();var j=this.points;var c=j.length;a.moveTo(j[0],j[1]);for(var b=2;b<c;b+=2){a.lineTo(j[b],j[b+1])}a.closePath()}else{a.rect(h+e[0],g+e[1],this.w-e[2]-e[0],this.h-e[3]-e[1])}}}else{var f=d.type;if(f==Shape.TypeBox){a.rect(h+e[0],g+e[1],d.width-e[2]-e[0],d.height-e[3]-e[1])}else{if(f==Shape.TypeCircle){a.arc(0,0,d.width,0,2*Math.PI,false)}else{if(f==Shape.TypePolygon){var j=d.vertices;var c=j.length;a.moveTo(j[0],j[1]);for(var b=2;b<c;b+=2){a.lineTo(j[b],j[b+1])}a.closePath()}}}}a.clip()};Actor.prototype.overlaps=function(e){var d=this.w;var g=this.h;var c=e.w;var f=e.h;var b=this.x-d/2;var i=this.y-g/2;var a=e.x-c/2;var h=e.y-f/2;return !((i+g<h)||(i>h+f)||(b>a+c)||(b+d<a))};"use strict";function Ease(){}Ease.linear=0;Ease.quadin=1;Ease.quadout=2;Ease.cubicin=3;Ease.cubicout=4;Ease.quartin=5;Ease.quartout=6;Ease.sin=7;Ease.easingFuncs=[function(a){return a},function(a){return a*a},function(a){return a*(2-a)},function(a){return a*a*a},function(a){a-=1;return a*a*a+1},function(a){return a*a*a*a},function(a){a-=1;return -(a*a*a*a-1)},function(a){return Math.sin(a*Math.PI/2)}];function Animation(a,d,c,f,e,b,g){this.timeline=a;this.state=Animation.AS_playing;this.time=-0.000001;this.repeats_left=b;this.index=-1;this.name=null;this.target=d;this.property=c;this.frames=f;this.times=e;this.easing=g;this.repeat=b;this.destroy=true;this.actions=[];this.time_scale=1;this.tween=true}Animation.AS_playing=0;Animation.AS_paused=1;Animation.prototype.pause=function(){this.state=Animation.AS_paused};Animation.prototype.play=function(){this.state=Animation.AS_playing};Animation.prototype.restart=function(){this.state=Animation.AS_playing;this.time=-0.000001;this.index=-1;this.repeats_left=this.repeat};Animation.prototype.update=function(c){if(this.state!=Animation.AS_playing){return}c*=this.time_scale;var d=this.time+c;var a=this.times;var l=this.frames;var k=a.length;var b=this.index;for(var o=b;o<k;o++){var i=a[o];if(d<i){this.index=o;if(d>=a[0]){if(this.index!=b){var f=this.actions[this.index-1];if(f!==undefined){f()}}var h=a[o-1];var g=l[o-1];var n=d-h;if(n!=0){if(this.tween){var j=i-h;var m=l[o]-g;if(this.easing!==undefined){this.target[this.property]=g+m*Ease.easingFuncs[this.easing[o-1]](n/j)}else{this.target[this.property]=g+(m*n)/j}}else{this.target[this.property]=g}}}break}}var e=a[a.length-1];if(d>e){if(this.repeat>0){this.repeats_left--}if(this.repeat==0||this.repeats_left>0){while(d>=e){d-=e}if(this.onRepeat!==undefined){this.onRepeat(this)}this.target[this.property]=l[0]}else{this.target[this.property]=l[a.length-1];this.state=Animation.AS_paused;if(this.onEnd!==undefined){this.onEnd(this)}if(this.destroy){this.timeline.remove(this)}}this.index=-1}this.time=d};Animation.prototype.setTime=function(a){this.time=a;this.index=-1;this.update(0)};Animation.prototype.setAction=function(b,a){this.actions[b]=a};function Timeline(c,b,e,d,a,f){this.anims=[];this.manager=null;this.name=null;if(c!==undefined){this.add(c,b,e,d,a,f)}}Timeline.prototype.add=function(d,c,f,e,b,g){var a=new Animation(this,d,c,f,e,b,g);this.anims.push(a);return a};Timeline.prototype.remove=function(d){var a=this.anims;var c=a.length;for(var b=0;b<c;b++){if(a[b]===d){a.splice(b,1);return}}};Timeline.prototype.find=function(b){var a=this.anims;var d=a.length;for(var c=0;c<d;c++){if(a[c].name===b){return a[c]}}return null};Timeline.prototype.pause=function(){var b=this.anims.length;for(var a=0;a<b;a++){this.anims[a].pause()}};Timeline.prototype.play=function(){var b=this.anims.length;for(var a=0;a<b;a++){this.anims[a].play()}};Timeline.prototype.restart=function(){var b=this.anims.length;for(var a=0;a<b;a++){this.anims[a].restart()}};Timeline.prototype.print=function(){var b=this.anims.length;for(var a=0;a<b;a++){console.log(this.anims[a])}};Timeline.prototype.update=function(c){var b=this.anims.length;if(b==0&&this.manager!==undefined){this.manager.remove(this);return}for(var a=b-1;a>=0;a--){this.anims[a].update(c)}};function TimelineManager(){this.timelines=[]}TimelineManager.prototype.add=function(a){this.timelines.push(a);a.manager=this;return a};TimelineManager.prototype.remove=function(d){var b=this.timelines;var c=b.length;for(var a=0;a<c;a++){if(b[a]===d){b.splice(a,1);return}}};TimelineManager.prototype.find=function(a){var c=this.timelines;var d=c.length;for(var b=0;b<d;b++){if(c[b].name===a){return c[b]}}return null};TimelineManager.prototype.pause=function(){var b=this.timelines.length;for(var a=0;a<b;a++){this.timelines[a].pause()}};TimelineManager.prototype.play=function(){var b=this.timelines.length;for(var a=0;a<b;a++){this.timelines[a].play()}};TimelineManager.prototype.restart=function(){var b=this.timelines.length;for(var a=0;a<b;a++){this.timelines[a].restart()}};TimelineManager.prototype.print=function(){var b=this.timelines.length;for(var a=0;a<b;a++){console.log(this.timelines[a])}};TimelineManager.prototype.update=function(c){var b=this.timelines.length;for(var a=b-1;a>=0;a--){this.timelines[a].update(c)}};"use strict";function TheApp(a){this.removals=[];this.touched=false;this.touch_pos={x:0,y:0};this.touch_drag_x=0;this.touch_drag_y=0;this.last_time=Date.now();this.dt=0;this.avg_time=0;this.avg_fps=60;this.avg_frame=0;this.canvas_scale=1;this.canvas_cx=this.canvas_width/2;this.canvas_cy=this.canvas_height/2;this.order_changed=true;this.total_loaded=0;this.total_load_errors=0;this.scenes=[];this.canvas=a;this.pixel_ratio=1;this.canvas_width=a.width;this.canvas_height=a.height;this.display_width=a.width;this.display_height=a.height;this.canvas_scale_method=TheApp.FitNone;this.touch_supported=this.isTouchSupported();this.allow_touchables=true;this.target_frame_rate=60;this.adaptive_physics=false;this.focus_scene=null;this.focus_scene2=null;this.clear_canvas=false;this.touch_focus=null;this.debug=false;this.use_marm=false;this.timelines=new TimelineManager();this.box2d=typeof Box2D!="undefined";this.loading_screen={background_fill:"#fffff",background_image:"loading.png",bar_background_fill:"#8080ff",bar_fill:"#ffffff"};this.bitmaps=[];this.brushes=[];this.shapes=[];this.materials=[];this.sounds=[];this.onResourceLoaded=function(c,b){this.onResourceLoadedBase(c,b)};if(window.devicePixelRatio!==undefined){this.pixel_ratio=window.devicePixelRatio}this.display=new Display(this.canvas);if(window.navigator.msPointerEnabled){a.addEventListener("MSPointerDown",this.onTouchStart,false);a.addEventListener("MSPointerMove",this.onTouchMove,false);a.addEventListener("MSPointerUp",this.onTouchEnd,false)}else{if(this.touch_supported){a.addEventListener("touchstart",this.onTouchStart,false);a.addEventListener("touchmove",this.onTouchMove,false);a.addEventListener("touchend",this.onTouchEnd,false)}else{a.addEventListener("mousedown",this.onTouchStart,false);a.addEventListener("mousemove",this.onTouchMove,false);a.addEventListener("mouseup",this.onTouchEnd,false);a.addEventListener("mouseout",this.onTouchEnd,false)}}window.addEventListener("keypress",this.onKeyPress,false);window.addEventListener("keydown",this.onKeyDown,false);window.addEventListener("keyup",this.onKeyUp,false);this.resize=function(b){window.app.setCanvasScalingMethod()};this.orientationChange=function(b){};window.addEventListener("resize",this.resize)}TheApp.version=1.42;TheApp.FitNone=0;TheApp.FitX=1;TheApp.FitY=2;TheApp.FitBest=3;TheApp.FitSize=4;TheApp.prototype.onKeyPress=function(a){var b=window.app;if(b.focus_scene!=null){b.focus_scene.onKeyPressBase(a)}};TheApp.prototype.onKeyDown=function(a){var b=window.app;if(b.focus_scene!=null){b.focus_scene.onKeyDownBase(a)}};TheApp.prototype.onKeyUp=function(a){var b=window.app;if(b.focus_scene!=null){b.focus_scene.onKeyUpBase(a)}};TheApp.prototype.isTouchSupported=function(){var b=window.navigator.msMaxTouchPoints;var a="ontouchstart" in this.canvas;if(b||a){return true}return false};TheApp.prototype.onTouchStart=function(f){var g=window.app;if(g.touch_supported){f.stopPropagation();f.preventDefault()}var b=g.focus_scene;var a=g.focus_scene2;var d=g.display;g.touched=true;if(g.touch_supported&&f.changedTouches!==undefined){g.touch_pos=d.getCanvasPoint(f.changedTouches[0].pageX,f.changedTouches[0].pageY)}else{g.touch_pos=d.getCanvasPoint(f.pageX,f.pageY)}if(b!=null){b.onBeginTouchBase(g.touch_pos)}if(a!=null){a.onBeginTouchBase(g.touch_pos)}if(g.allow_touchables){var c=g.findHitActor(g.touch_pos);if(c!=null){g.touch_focus=c;c.onBeginTouchBase(g.touch_pos)}}};TheApp.prototype.onTouchEnd=function(f){var g=window.app;if(g.touch_supported){f.stopPropagation();f.preventDefault()}var b=g.focus_scene;var a=g.focus_scene2;var d=g.display;g.touched=false;if(g.touch_supported&&f.changedTouches!==undefined){g.touch_pos=d.getCanvasPoint(f.changedTouches[0].pageX,f.changedTouches[0].pageY)}else{g.touch_pos=d.getCanvasPoint(f.pageX,f.pageY)}if(b!=null){b.onEndTouchBase(g.touch_pos)}if(a!=null){a.onEndTouchBase(g.touch_pos)}if(g.allow_touchables){var c=g.findHitActor(g.touch_pos);if(c!=null){c.onEndTouchBase(g.touch_pos)}if(g.touch_focus!=null){if(g.touch_focus.onLostTouchFocus!==undefined){g.touch_focus.onLostTouchFocus(g.touch_pos)}g.touch_focus=null}}};TheApp.prototype.onTouchMove=function(g){var h=window.app;if(h.touch_supported){g.stopPropagation();g.preventDefault()}var c=h.focus_scene;var b=h.focus_scene2;var a=h.touch_pos.x;var i=h.touch_pos.y;var f=h.display;if(h.touch_supported&&g.changedTouches!==undefined){h.touch_pos=f.getCanvasPoint(g.changedTouches[0].pageX,g.changedTouches[0].pageY)}else{h.touch_pos=f.getCanvasPoint(g.pageX,g.pageY)}h.touch_drag_x=a-h.touch_pos.x;h.touch_drag_y=i-h.touch_pos.y;if(c!=null){c.onMoveTouchBase(h.touch_pos)}if(b!=null){b.onMoveTouchBase(h.touch_pos)}if(h.allow_touchables){var d=h.findHitActor(h.touch_pos);if(d!=null){d.onMoveTouchBase(h.touch_pos)}}};TheApp.prototype.addScene=function(a){this.scenes.push(a);a.app=this;return a};TheApp.prototype.removeScene=function(a){if(this.focus_scene==a){this.focus_scene=null}this.removals.push(a)};TheApp.prototype.cleanupDestroyedScenes=function(){var f=this.removals.length;if(f>0){var d=this.removals;var a=this.scenes;var e=a.length;for(var c=0;c<f;c++){var g=d[c];for(var b=0;b<e;b++){if(g==a[b]){g.release();a.splice(b,1);e--;break}}}}this.removals=[]};TheApp.prototype.findScene=function(b){var a=this.scenes;var d=a.length;for(var c=0;c<d;c++){if(a[c].name==b){return a[c]}}return null};TheApp.prototype.getResFromType=function(a){if(a=="brush"){return this.brushes}else{if(a=="sound"){return this.sounds}else{if(a=="shape"){return this.shapes}else{if(a=="material"){return this.materials}else{if(a=="bitmap"){return this.bitmaps}}}}}return null};TheApp.prototype.addResource=function(c,b){var a=this.getResFromType(b);if(a!=null){a.push(c);a.parent=this}};TheApp.prototype.removeResource=function(e,c){var b=this.getResFromType(c);if(b!=null){var d=b.length;for(var a=0;a<d;a++){if(b[a].name==name){b.splice(a,1);return}}}};TheApp.prototype.findResource=function(a,d){var c=this.getResFromType(d);if(c==null){return null}var e=c.length;for(var b=0;b<e;b++){if(c[b].name==a){return c[b]}}if(this.debug){console.log("resource '"+a+"' ("+d+") not found")}return null};TheApp.prototype.countResourcesNeedLoading=function(f){var e=0;var c=this.bitmaps;var d=c.length;for(var b=0;b<d;b++){if(c[b].preload){e++}}c=this.sounds;d=c.length;for(b=0;b<d;b++){if(c[b].preload){e++}}if(f){var a=this.scenes;d=a.length;for(b=0;b<d;b++){e+=a[b].countResourcesNeedLoading()}}return e};TheApp.prototype.onResourceLoadedBase=function(b,a){if(b.preload){window.app.total_loaded++}if(a){if(b.preload){window.app.total_load_errors++}console.log("Error loading resource "+b.name)}else{if(this.debug){console.log("Resource loaded "+b.name)}}b.loaded=true};TheApp.prototype.waitForResources=function(){var b=this;var h=b.display;var i=b.canvas_scale;var f=400;var d=80;var a=h.context;a.setTransform(1,0,0,1,0,0);a.fillStyle=b.loading_screen.background_fill;a.fillRect(0,0,b.display_width,b.display_height);var e=new Image();e.src=b.loading_screen.background_image;e.onload=function(){a.setTransform(i,0,0,i,b.canvas_cx,b.canvas_cy);a.drawImage(e,-e.width>>1,-e.height>>1,e.width,e.height);a.fillStyle=b.loading_screen.bar_background_fill;h.drawRoundRect(-f>>1,(b.canvas_height>>2)-(d>>1),f,d,20,true)};var g=b.countResourcesNeedLoading(true);var c=setInterval(function(){var l=window.app.total_loaded;if(window.app.total_loaded>=g){if(window.app.debug){console.log("Total resources loaded "+l+" of "+g);console.log("Total resource load errors "+window.app.total_load_errors)}clearInterval(c);var o=setInterval(function(){b.start();clearInterval(o)},1000)}var k=f-20;var n=d-20;var m=l/g;if(m>1){m=1}var j=(k*m)<<0;a.fillStyle=b.loading_screen.bar_fill;h.drawRoundRect(-k>>1,(b.canvas_height>>2)-(n>>1),j,n,10,true)},100)};TheApp.prototype.draw=function(){var a=this.scenes;var c=a.length;for(var b=0;b<c;b++){a[b].draw()}};TheApp.prototype.update=function(d){var e=window.app;var a=this.scenes;var c=a.length;e.dt=d;e.timelines.update(d);for(var b=0;b<c;b++){a[b].update(d)}this.cleanupDestroyedScenes();if(this.order_changed){this.order_changed=false;Utils.sortLayers(this.scenes)}};TheApp.prototype.mainLoop=function(){var b=window.app;var a=Date.now();var c=a-b.last_time;b.last_time=a;if(b.clear_canvas){b.display.clear(true)}b.update(c/1000);b.draw();b.avg_time+=c;b.avg_frame++;if(b.avg_frame==60){b.avg_frame=0;b.avg_fps=60000/b.avg_time;b.avg_time=0}requestAnimationFrame(b.mainLoop)};TheApp.prototype.start=function(){this.mainLoop();this.dirty()};TheApp.prototype.findHitActor=function(a){var b=null;if(this.focus_scene!==null){b=this.focus_scene.findHitActor(a)}if(b===null&&this.focus_scene2!==null){b=this.focus_scene2.findHitActor(a)}return b};TheApp.prototype.dirty=function(){var b=this.scenes;var c=b.length;for(var a=0;a<c;a++){b[a].dirty()}};TheApp.prototype.setCanvasScalingMethod=function(h){if(h!==undefined){this.canvas_scale_method=h}var b=window.innerWidth;var d=window.innerHeight;if(this.canvas_scale_method===TheApp.FitNone){}else{if(this.canvas_scale_method===TheApp.FitSize){this.canvas_scale=1;this.canvas.width=b;this.canvas.height=d;this.display_width=b;this.display_height=d;this.canvas_cx=b/2;this.canvas_cy=d/2}else{this.scaleCanvasToFit=true;var a=this.canvas_width;var c=this.canvas_height;var g=b/a;var f=d/c;var e=1;switch(this.canvas_scale_method){case TheApp.FitX:e=g;break;case TheApp.FitY:e=f;break;case TheApp.FitBest:e=g<f?g:f;break}this.canvas_scale=e;this.display_width=b;this.display_height=d;this.canvas.width=b*this.pixel_ratio;this.canvas.height=d*this.pixel_ratio;this.canvas_cx=b/2;this.canvas_cy=d/2}}this.dirty()};TheApp.prototype.parseAndSetFocus=function(a){new Xoml(this).parseResources(this,[window[a]]);this.order_changed=true;this.focus_scene=this.findScene(a)};"use strict";ArcActor.prototype=new Actor();ArcActor.prototype.constructor=ArcActor;ArcActor.prototype.parent=Actor.prototype;function ArcActor(){this.fill_style="#ffffff";this.stroke_style="#ffffff";this.stroke_thickness=1;this.radius=1;this.start_angle=0;this.end_angle=2*Math.PI;this.filled=true;Actor.call(this);this.type=Actor.Type_Arc}ArcActor.prototype.update=function(a){return this.baseUpdate(a)};ArcActor.prototype.draw=function(){if(!this.visible){return}if(this.cache){this.drawToCache();this.cache=false}if(this.merge_cache){return}var a=this.cache_canvas;var e=this.scene;var d=e.app;var l=d.canvas_scale;var b=d.display.context;if(a===null){if(this.filled&&this.fill_style!=""){b.fillStyle=this.fill_style}if(!this.filled&&this.stroke_style!=""){b.strokeStyle=this.stroke_style}if(!this.filled){b.lineWidth=this.stroke_thickness}}this.preDraw(b);var j=d.canvas_cx+e.x*l;var h=d.canvas_cy+e.y*l;if(!this.ignore_camera&&(this.depth==0||this.depth==1)){j-=e.camera_x*l;h-=e.camera_y*l}this.updateTransform();var m=this.transform;var g=this.self_clip;var c=this.clip_children;b.setTransform(m[0]*l,m[1]*l,m[2]*l,m[3]*l,m[4]*l+j,m[5]*l+h);if(g){this.setClipping(b,0,0)}if(a===null){d.display.drawArc(0,0,this.radius,this.start_angle,this.end_angle,this.filled)}else{b.drawImage(a,-a.width>>1,-a.height>>1)}this.postDraw(b);if(c){if(!g){this.setClipping(b,0,0)}}else{if(g){b.restore()}}var f=this.actors.length;if(f>0){var i=this.actors;for(var k=0;k<f;k++){i[k].draw()}}if(c){b.restore()}};ArcActor.prototype.drawToCache=function(){var a=null;var j=this.w;var g=this.h;var d=0;var c=0;if(this.merge_cache){var i=this.findFirstCachedParent();if(i!==null){a=i.cache_canvas;d=this.x+a.width/2-j/2;c=this.y+a.height/2-g/2}}if(a===null){a=document.createElement("canvas");if(!this.filled&&this.stroke_style!==""){j+=this.stroke_thickness;g+=this.stroke_thickness;d=(this.stroke_thickness/2+0.5)<<0;c=(this.stroke_thickness/2+0.5)<<0}a.width=j;a.height=g}var f=this.scene;var e=f.app;var b=a.getContext("2d");if(this.filled&&this.fill_style!=""){b.fillStyle=this.fill_style}if(!this.filled&&this.stroke_style!=""){b.strokeStyle=this.stroke_style}if(!this.filled){b.lineWidth=this.stroke_thickness}b.setTransform(1,0,0,1,d+this.w/2,c+this.h/2);e.display.drawArc(0,0,this.radius,this.start_angle,this.end_angle,this.filled,b);this.cache_canvas=a};ArcActor.prototype.hitTest=function(h){if(!this.touchable){return null}var i=this.actors.length;var j;if(i>0){var p=this.actors;for(var q=0;q<i;q++){j=p[q].hitTest(h);if(j!=null){return j}}}var g=this.scene;var s=this.transform;var c=s[4]+g.x;var b=s[5]+g.y;if(!this.ignore_camera){c-=g.camera_x;b-=g.camera_y}var n=this.accum_scale_x;var l=this.accum_scale_y;var o=(h.x-c)/n;var m=(h.y-b)/l;var f=o*s[0]+m*s[1];var e=o*s[2]+m*s[3];var a=this.radius*n;a*=a;var k=f*f+e*e;if(k<=a){return this}return null};"use strict";function Bitmap(c,a,b,e){this.image=new Image();this.parent=null;this.name=c;this.location=a;this.onload=e;this.preload=b;this.loaded=false;if(b){var d=this;this.image.onload=function(){window.app.onResourceLoaded(d,false);if(e!==undefined){e()}};this.image.onerror=function(){window.app.onResourceLoaded(d,true)};this.image.src=a}}Bitmap.prototype.load=function(){var a=this;this.image.onload=function(){window.app.onResourceLoaded(a,false);if(a.onload!==undefined){a.onload()}};this.image.onerror=function(){window.app.onResourceLoaded(a,true)};this.image.src=this.location};Bitmap.prototype.destroy=function(){this.image=null;if(this.parent!=null){this.parent.removeResource(this,"bitmap")}};"use strict";function Display(a){this.canvas=a;this.context=a.getContext("2d");this.context.lineWidth=1;this.context.strokeStyle="black";this.context.fillStyle="black";this.context.globalAlpha=1;this.context.lineJoin="round";this.context.lineCap="round"}Display.prototype.getCanvasPoint=function(b,a){var d=window.app;var c=d.canvas_scale;return{x:(b-this.canvas.offsetLeft-d.canvas_cx)/c,y:(a-this.canvas.offsetTop-d.canvas_cy)/c}};Display.prototype.clear=function(c){var b=window.app;var a=this.context;a.setTransform(1,0,0,1,0,0);a.clearRect(0,0,b.display_width,b.display_height)};Display.prototype.drawPolygon=function(a,h,e,g,d){var b=this.context;if(d!==undefined){b=d}var f=e.length;b.beginPath();b.moveTo(e[0]+a,e[1]+h);for(var c=2;c<f;c+=2){b.lineTo(e[c]+a,e[c+1]+h)}if(g){b.fill()}else{b.lineTo(e[0]+a,e[1]+h);b.stroke()}return this};Display.prototype.drawLine=function(c,f,b,e,d){var a=this.context;if(d!==undefined){a=d}a.beginPath();a.moveTo(c,f);a.lineTo(b,e);a.stroke();return this};Display.prototype.drawRect=function(a,g,c,e,f,d){var b=this.context;if(d!==undefined){b=d}if(f){b.fillRect(a,g,c,e)}else{b.strokeRect(a,g,c,e)}return this};Display.prototype.drawRoundRect=function(b,i,d,f,a,g,e){var c=this.context;if(e!==undefined){c=e}c.beginPath();c.moveTo(b+a,i);c.lineTo(b+d-a,i);c.quadraticCurveTo(b+d,i,b+d,i+a);c.lineTo(b+d,i+f-a);c.quadraticCurveTo(b+d,i+f,b+d-a,i+f);c.lineTo(b+a,i+f);c.quadraticCurveTo(b,i+f,b,i+f-a);c.lineTo(b,i+a);c.quadraticCurveTo(b,i,b+a,i);c.closePath();if(g){c.fill()}else{c.stroke()}};Display.prototype.drawArc=function(b,h,a,e,g,f,d){var c=this.context;if(d!==undefined){c=d}c.beginPath();c.arc(b,h,a,e,g);if(f){c.fill()}else{c.stroke()}return this};Display.prototype.drawAtlasImage=function(b,e,d,f,a,i,g,j,c){this.context.drawImage(b,e,d,f,a,i,g,j,c)};Display.prototype.drawImage=function(d,a,e,b,c){this.context.drawImage(d,a,e,b,c)};"use strict";function Gradient(b,a){this.parent=null;this.name=b;if(a!==undefined){this.stops=a}else{this.stops=[]}}Gradient.prototype.addColourStop=function(a,b){this.stops.push({c:a,offs:b})};Gradient.prototype.getColourStop=function(a){return this.stops[a]};Gradient.prototype.getMaxStops=function(){return this.stops.length};Gradient.prototype.destroy=function(){if(this.parent!=null){this.parent.removeResource(this,"brush")}};Gradient.prototype.createStyle=function(j,e,b,d){if(this.stops!==undefined){var c=0,g=0;var a=1,f=0;if(b!==undefined){c=b.x;g=b.y}if(d!==undefined){a=d.x;f=d.y}c=c*j-j/2;g=g*e-e/2;a=a*j-j/2;f=f*e-e/2;var i=window.app.display.context.createLinearGradient(c,g,a,f);for(var k=0;k<this.stops.length;k++){var l=this.stops[k];i.addColorStop(l.offs,l.c)}return i}return null};"use strict";function ImageAtlas(c,e,a,f,b,d){this.frames=[];this.parent=null;this.name=c;this.bitmap=e;if(a!==undefined&&f!==undefined&&b!==undefined&&d!==undefined){this.addFrame(a,f,b,d)}}ImageAtlas.prototype.addFrame=function(d,c,a,b){this.frames.push({x:d,y:c,w:a,h:b})};ImageAtlas.prototype.getFrame=function(a){return this.frames[a]};ImageAtlas.prototype.getMaxFrames=function(){return this.frames.length};ImageAtlas.prototype.generate=function(k,i,a,g,j,h,e){if(e!==undefined){e=j*h}var b=i;for(var d=0;d<h;d++){var c=k;for(var f=0;f<j;f++){this.addFrame(c,b,a,g);c+=a;e--;if(e<=0){return}}b+=g}};ImageAtlas.prototype.destroy=function(){if(this.parent!=null){this.parent.removeResource(this,"brush")}};"use strict";LabelActor.prototype=new Actor();LabelActor.prototype.constructor=LabelActor;LabelActor.prototype.parent=Actor.prototype;function LabelActor(){this.text="";this.font="16pt Calibri";this.text_align="center";this.text_baseline="middle";this.fill_style="#ffffff";this.stroke_style="#ffffff";this.stroke_thickness=1;this.filled=true;Actor.call(this);this.type=Actor.Type_Label}LabelActor.prototype.update=function(a){return this.baseUpdate(a)};LabelActor.prototype.draw=function(){if(!this.visible||this.text==""){return}if(this.cache){this.drawToCache();this.cache=false}if(this.merge_cache){return}var a=this.cache_canvas;var d=this.scene;var c=d.app;var j=c.canvas_scale;var b=c.display.context;if(a===null){if(this.font!=""){b.font=this.font}if(this.textAlign!=""){b.textAlign=this.text_align}if(this.textBaseline!=""){b.textBaseline=this.text_baseline}if(this.filled&&this.fill_style!=""){b.fillStyle=this.fill_style}if(!this.filled&&this.stroke_style!=""){b.strokeStyle=this.stroke_style}if(!this.filled){b.lineWidth=this.stroke_thickness}}this.preDraw(b);var h=c.canvas_cx+d.x*j;var f=c.canvas_cy+d.y*j;if(!this.ignore_camera&&(this.depth==0||this.depth==1)){h-=d.camera_x*j;f-=d.camera_y*j}this.updateTransform();var k=this.transform;b.setTransform(k[0]*j,k[1]*j,k[2]*j,k[3]*j,k[4]*j+h,k[5]*j+f);if(a===null){if(this.filled){b.fillText(this.text,0,0)}else{b.strokeText(this.text,0,0)}}else{b.drawImage(a,-a.width>>1,-a.height>>1)}this.postDraw(b);if(this.shadow){b.shadowColor="transparent"}var e=this.actors.length;if(e>0){var g=this.actors;for(var i=0;i<e;i++){g[i].draw()}}};LabelActor.prototype.drawToCache=function(){var d=null;var b=this.w;var g=this.h;var c=0;var a=0;if(this.merge_cache){var f=this.findFirstCachedParent();if(f!==null){d=f.cache_canvas;c=this.x+d.width/2-b/2;a=this.y+d.height/2-g/2}}if(d===null){d=document.createElement("canvas");d.width=b;d.height=g}var e=d.getContext("2d");if(this.font!=""){e.font=this.font}if(this.textAlign!=""){e.textAlign=this.text_align}if(this.textBaseline!=""){e.textBaseline=this.text_baseline}if(this.filled&&this.fill_style!=""){e.fillStyle=this.fill_style}if(!this.filled&&this.stroke_style!=""){e.strokeStyle=this.stroke_style}if(!this.filled){e.lineWidth=this.stroke_thickness}e.setTransform(1,0,0,1,0,0);if(this.filled){e.fillText(this.text,c+b/2,a+g/2)}else{e.strokeText(this.text,c+b/2,a+g/2)}this.cache_canvas=d};"use strict";function Material(a){this.parent=null;this.name=a;this.type="static";this.density=1;this.friction=0.1;this.restitution=0.1;this.gravity_scale=1;this.fixed_rotation=false;this.is_bullet=false}Material.prototype.destroy=function(){if(this.parent!=null){this.parent.removeResource(this,"material")}};"use strict";function Maths(){}Maths.mulMatrix=function(b,a){var n=a[0];var m=a[1];var l=a[2];var k=a[3];var j=a[4];var i=a[5];var h=b[0];var g=b[1];var f=b[2];var e=b[3];var d=b[4];var c=b[5];b[0]=n*h+l*g;b[1]=m*h+k*g;b[2]=n*f+l*e;b[3]=m*f+k*e;b[4]=n*d+l*c+j;b[5]=m*d+k*c+i};Maths.preMulMatrix=function(b,a){var n=b[0];var m=b[1];var l=b[2];var k=b[3];var j=b[4];var i=b[5];var h=a[0];var g=a[1];var f=a[2];var e=a[3];var d=a[4];var c=a[5];b[0]=n*h+l*g;b[1]=m*h+k*g;b[2]=n*f+l*e;b[3]=m*f+k*e;b[4]=n*d+l*c+j;b[5]=m*d+k*c+i};Maths.vecMulMatrix=function(b,e,d){var c=b*d[0]+e*d[2]+d[4];var a=b*d[1]+e*d[3]+d[5];return{x:c,y:a}};"use strict";ParticleActor.prototype=new Actor();ParticleActor.prototype.constructor=ParticleActor;ParticleActor.prototype.parent=Actor.prototype;function ParticleActor(){Actor.call(this);this.type=Actor.Type_Particle;this.gravity=0}ParticleActor.prototype.resetParticle=function(b){b.life_time=0;if(b.orphaned){var a=this.transformPoint(b.org_x+this.x,b.org_y+this.y);b.x=a.x;b.y=a.y}else{b.x=b.org_x;b.y=b.org_y}b.rotation=b.org_rotation;b.scale_x=b.org_scale_x;b.scale_y=b.org_scale_y;b.depth=b.org_depth;b.opacity=b.org_opacity;b.current_frame=b.org_current_frame;b.vr=b.org_vr;b.vx=b.org_vx;b.vy=b.org_vy;b.vd=b.org_vd;b.vo=b.org_vo;b.vsx=b.org_vsx;b.vsy=b.org_vsy};ParticleActor.prototype.addParticle=function(d,b,e,a){this.addActor(d);if(d.vo===undefined){d.vo=0}if(d.vsx===undefined){d.vsx=0}if(d.vsy===undefined){d.vsy=0}d.life_time=-a;d.life_span=b;d.num_lives=e;if(d.life_time<0){d.active=false;d.visible=false}d.org_num_lives=d.num_lives;d.org_x=d.x;d.org_y=d.y;d.org_rotation=d.rotation;d.org_scale_x=d.scale_x;d.org_scale_y=d.scale_y;d.org_depth=d.depth;d.org_opacity=d.opacity;d.org_current_frame=d.current_frame;d.org_vr=d.vr;d.org_vx=d.vx;d.org_vy=d.vy;d.org_vd=d.vd;d.org_vo=d.vo;d.org_vsx=d.vsx;d.org_vsy=d.vsy;if(d.orphaned){var c=this.transformPoint(d.org_x+this.x,d.org_y+this.y);d.x=c.x;d.y=c.y}return d};ParticleActor.prototype.update=function(e){var d=this.actors;var c=d.length;if(c==0){if(this.onParticlesEnd!==undefined){this.onParticlesEnd()}this.destroy()}else{for(var b=c-1;b>=0;b--){var f=d[b];f.life_time+=e;var a=f.life_time;if(a>=0){if(a-e<0&&a>=0){f.active=true;f.visible=true}if(f.active){f.scale_x+=f.vsx*e;f.scale_y+=f.vsy*e;f.opacity+=f.vo*e;if(f.opacity<0){f.opacity=0}f.vy+=this.gravity*e;f.update(e);if(a>=f.life_span){if(f.num_lives>0){f.num_lives--}if(f.num_lives>0||f.org_num_lives==0){this.resetParticle(f)}else{if(this.onParticleLost!==undefined){if(this.onParticleLost(f)){f.destroy()}}else{f.destroy()}}}}}}}return this.baseUpdate(e)};ParticleActor.prototype.generateExplosion=function(f,i,c,b,k,g,d,h){this.updateParentTransforms();for(var j=0;j<f;j++){var e=new i;for(var a in h){e[a]=h[a]}e.vr+=Math.random()*k;e.vx+=Math.random()*b-b/2;e.vy+=Math.random()*b-b/2;e.vx_damping=d;e.vy_damping=d;e.vo=-1/c;this.addParticle(e,c,1,j/(f*g))}};ParticleActor.prototype.generatePlume=function(f,i,c,b,k,g,d,h){this.updateParentTransforms();for(var j=0;j<f;j++){var e=new i;for(var a in h){e[a]=h[a]}e.vr+=Math.random()*k;e.vx+=Math.random()*b-b/2;e.vy+=Math.random()*-b-b/2;e.vx_damping=d;e.vy_damping=d;e.vo=-1/c;this.addParticle(e,c,0,j/(f*g))}};ParticleActor.prototype.generateRain=function(g,j,d,c,l,h,e,b,i){this.updateParentTransforms();for(var k=0;k<g;k++){var f=new j;for(var a in i){f[a]=i[a]}f.x=Math.random()*b-b/2;f.vr+=Math.random()*l;f.vy+=Math.random()*c+c/2;f.vx_damping=e;f.vy_damping=e;f.vo=-1/d;this.addParticle(f,d,0,k/(g*h))}};"use strict";PolygonActor.prototype=new Actor();PolygonActor.prototype.constructor=PolygonActor;PolygonActor.prototype.parent=Actor.prototype;function PolygonActor(){this.fill_style="#ffffff";this.stroke_style="";this.stroke_thickness=1;this.filled=true;this.points=null;Actor.call(this);this.type=Actor.Type_Polygon}PolygonActor.prototype.update=function(a){return this.baseUpdate(a)};PolygonActor.prototype.draw=function(){if(!this.visible||this.points==null){return}if(this.cache){this.drawToCache();this.cache=false}if(this.merge_cache){return}var a=this.cache_canvas;var e=this.scene;var d=e.app;var b=d.display.context;if(a===null){if(this.filled&&this.fill_style!=""){b.fillStyle=this.fill_style}if(!this.filled&&this.stroke_style!=""){b.strokeStyle=this.stroke_style}if(!this.filled){b.lineWidth=this.stroke_thickness}}this.preDraw(b);var l=d.canvas_scale;var j=d.canvas_cx+this.scene.x*l;var h=d.canvas_cy+this.scene.y*l;if(!this.ignore_camera&&(this.depth==0||this.depth==1)){j-=e.camera_x*l;h-=e.camera_y*l}this.updateTransform();var m=this.transform;var g=this.self_clip;var c=this.clip_children;b.setTransform(m[0]*l,m[1]*l,m[2]*l,m[3]*l,m[4]*l+j,m[5]*l+h);if(g){this.setClipping(b,0,0)}if(a===null){d.display.drawPolygon(0,0,this.points,this.filled)}else{b.drawImage(a,-a.width>>1,-a.height>>1)}this.postDraw(b);if(c){if(!g){this.setClipping(b,0,0)}}else{if(g){b.restore()}}var f=this.actors.length;if(f>0){var i=this.actors;for(var k=0;k<f;k++){i[k].draw()}}if(c){b.restore()}};PolygonActor.prototype.drawToCache=function(){var a=null;var j=this.w;var g=this.h;var d=0;var c=0;if(this.merge_cache){var i=this.findFirstCachedParent();if(i!==null){a=i.cache_canvas;d=this.x+a.width/2-j/2;c=this.y+a.height/2-g/2}}if(a===null){a=document.createElement("canvas");if(!this.filled&&this.stroke_style!=""){j+=this.stroke_thickness;g+=this.stroke_thickness}a.width=j;a.height=g}var f=this.scene;var e=f.app;var b=a.getContext("2d");if(this.filled&&this.fill_style!=""){b.fillStyle=this.fill_style}if(!this.filled&&this.stroke_style!=""){b.strokeStyle=this.stroke_style}if(!this.filled){b.lineWidth=this.stroke_thickness}b.setTransform(1,0,0,1,d+this.w/2,c+this.h/2);e.display.drawPolygon(0,0,this.points,this.filled,b);this.cache_canvas=a};"use strict";RectActor.prototype=new Actor();RectActor.prototype.constructor=RectActor;RectActor.prototype.parent=Actor.prototype;function RectActor(){this.fill_style="#ffffff";this.stroke_style="#ffffff";this.stroke_thickness=1;this.corner_radius=0;this.filled=true;Actor.call(this);this.type=Actor.Type_Rect}RectActor.prototype.update=function(a){return this.baseUpdate(a)};RectActor.prototype.draw=function(){if(!this.visible){return}if(this.cache){this.drawToCache();this.cache=false}if(this.merge_cache){return}var a=this.cache_canvas;var g=this.scene;var d=g.app;var o=d.canvas_scale;var b=d.display.context;if(a===null){if(this.filled&&this.fill_style!=""){b.fillStyle=this.fill_style}if(!this.filled&&this.stroke_style!=""){b.strokeStyle=this.stroke_style}if(!this.filled){b.lineWidth=this.stroke_thickness}}this.preDraw(b);var l=d.canvas_cx+g.x*o;var j=d.canvas_cy+g.y*o;var f=this.w/2;var e=this.h/2;f=(f+0.5)<<0;e=(e+0.5)<<0;if(!this.ignore_camera&&(this.depth==0||this.depth==1)){l-=g.camera_x*o;j-=g.camera_y*o}this.updateTransform();var n=this.transform;var i=this.self_clip;var c=this.clip_children;b.setTransform(n[0]*o,n[1]*o,n[2]*o,n[3]*o,n[4]*o+l,n[5]*o+j);if(i){this.setClipping(b,-f,-e)}if(a===null){if(this.corner_radius!=0){d.display.drawRoundRect(-f,-e,this.w,this.h,this.corner_radius,this.filled)}else{d.display.drawRect(-f,-e,this.w,this.h,this.filled)}}else{b.drawImage(a,-a.width>>1,-a.height>>1)}this.postDraw(b);if(c){if(!i){this.setClipping(b,-f,-e)}}else{if(i){b.restore()}}var h=this.actors.length;if(h>0){var k=this.actors;for(var m=0;m<h;m++){k[m].draw()}}if(c){b.restore()}};RectActor.prototype.drawToCache=function(){var a=null;var j=this.w;var g=this.h;var d=0;var c=0;if(this.merge_cache){var i=this.findFirstCachedParent();if(i!==null){a=i.cache_canvas;d=this.x+a.width/2-j/2;c=this.y+a.height/2-g/2}}if(a===null){a=document.createElement("canvas");if(!this.filled&&this.stroke_style!=""){j+=this.stroke_thickness;g+=this.stroke_thickness;d=this.stroke_thickness>>1;c=this.stroke_thickness>>1}a.width=j;a.height=g}var f=this.scene;var e=f.app;var b=a.getContext("2d");if(this.filled&&this.fill_style!=""){b.fillStyle=this.fill_style}if(!this.filled&&this.stroke_style!=""){b.strokeStyle=this.stroke_style}if(!this.filled){b.lineWidth=this.stroke_thickness}b.setTransform(1,0,0,1,j/2+d,g/2+c);if(this.corner_radius!=0){e.display.drawRoundRect(-j/2,-g/2,this.w,this.h,this.corner_radius,this.filled,b)}else{e.display.drawRect(-j/2,-g/2,this.w,this.h,this.filled,b)}this.cache_canvas=a};"use strict";function Scene(){this.app=null;this.actors=[];this.removals=[];this.frame_count=0;this.world=null;this.touching=false;this.touchmove=false;this.timelines=new TimelineManager();this.order_changed=true;this.name="";this.tag="";this.active=true;this.visible=true;this.layer=0;this.x=0;this.y=0;this.w=1024;this.h=768;this.clip_children=true;this.clip_shape=null;this.camera_x=0;this.camera_y=0;this.camera_vx=0;this.camera_vy=0;this.follow_speed_x=0.3;this.follow_speed_y=0.3;this.target_x=null;this.target_y=null;this.touch_pan_x=false;this.touch_pan_y=false;this.panning=false;this.min_panning=0;this.world_scale=20;this.time_step=0;this.extents=[0,0,0,0];this.opacity=1;this.bitmaps=[];this.brushes=[];this.shapes=[];this.materials=[];this.sounds=[]}Object.defineProperty(Scene.prototype,"_layer",{get:function(){return this.layer},set:function(a){if(this.layer!=a){this.layer=a;this.app.order_changed=true}}});Scene.prototype.release=function(){if(this.onDestroy!==undefined){this.onDestroy()}this.world=null;this.actors=null};Scene.prototype.destroy=function(){this.app.removeScene(this)};Scene.prototype.addActor=function(a){this.actors.push(a);a.scene=this;return a};Scene.prototype.removeActor=function(a){this.removals.push(a)};Scene.prototype.removeActorsWithTag=function(a){var b=this.actors;var e=b.length;var d=this.removals;for(var c=0;c<e;c++){if(b[c].tag==a){d.push(b[c])}}};Scene.prototype.cleanupDestroyedActors=function(){var f=this.removals.length;if(f>0){var d=this.removals;var a=this.actors;var e=a.length;for(var c=0;c<f;c++){var g=d[c];for(var b=0;b<e;b++){if(g==a[b]){g.release();a.splice(b,1);e--;break}}}}this.removals=[]};Scene.prototype.findActor=function(d,c){if(c===undefined){c=false}var b=this.actors;var f=b.length;for(var e=0;e<f;e++){if(b[e].name==d){return b[e]}else{if(c){var a=b[e].findActor(d,c);if(a!=null){return a}}}}return null};Scene.prototype.bringToFront=function(){var a=this.app.scenes;var d=a.length;var c=-1;for(var b=0;b<d;b++){if(a[b]==this){c=b;break}}if(c>=0){a.splice(c,1);a.push(this)}};Scene.prototype.sendToBack=function(){var a=this.app.scenes;var d=a.length;var c=-1;for(var b=0;b<d;b++){if(a[b]==this){c=b;break}}if(c>=0){a.splice(c,1);a.unshift(this)}};Scene.prototype.onKeyPressBase=function(a){if(this.onKeyPress!==undefined){this.onKeyPress(a)}};Scene.prototype.onKeyDownBase=function(a){if(this.onKeyDown!==undefined){this.onKeyDown(a)}};Scene.prototype.onKeyUpBase=function(a){if(this.onKeyUp!==undefined){this.onKeyUp(a)}};Scene.prototype.onBeginTouchBase=function(a){this.touching=true;if(this.onBeginTouch!==undefined){this.onBeginTouch(a)}};Scene.prototype.onEndTouchBase=function(a){if(this.touching&&this.onTapped!==undefined){this.onTapped(a)}this.touching=false;this.touchmove=false;if(this.onEndTouch!==undefined){this.onEndTouch(a)}this.panning=false};Scene.prototype.onMoveTouchBase=function(a){this.touchmove=true;if(this.onMoveTouch!==undefined){this.onMoveTouch(a)}if(this.touching){var c=this.app;var b=0;if(this.touch_pan_x){b=c.touch_drag_x;this.camera_vx=b*c.target_frame_rate;this.camera_x+=b}if(this.touch_pan_y){b=c.touch_drag_y;this.camera_vy=b*c.target_frame_rate;this.camera_y+=b}if((c.touch_drag_x*c.touch_drag_x+c.touch_drag_y*c.touch_drag_y)>this.min_panning){this.panning=true}}};Scene.prototype.initWorld=function(a,d,b){if(!app.box2d){return}this.world=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(a,d),b);var c=new Box2D.Dynamics.b2ContactListener;c.BeginContact=function(e){var f=e.GetFixtureA().GetBody().GetUserData();if(f.onCollisionStart!==undefined){f.onCollisionStart(e)}f=e.GetFixtureB().GetBody().GetUserData();if(f.onCollisionStart!==undefined){f.onCollisionStart(e)}};c.EndContact=function(e){var f=e.GetFixtureA().GetBody().GetUserData();if(f.onCollisionEnd!==undefined){f.onCollisionEnd(e)}f=e.GetFixtureB().GetBody().GetUserData();if(f.onCollisionEnd!==undefined){f.onCollisionEnd(e)}};this.world.SetContactListener(c)};Scene.prototype.draw=function(){if(!this.visible){return}var b=this.app;var l=b.canvas_scale;var a=b.display.context;if(this.clip_children){var g=b.canvas_cx+this.x;var f=b.canvas_cy+this.y;a.setTransform(l,0,0,l,g,f);a.save();a.beginPath();if(this.clip_shape==null){a.rect(-this.w/2,-this.h/2,this.w,this.h)}else{var e=this.clip_shape;if(this.clip_shape.type==Shape.TypeBox){a.rect(0,0,e.width,e.height)}else{if(this.clip_shape.type==Shape.TypeCircle){a.arc(0,0,e.width,0,2*Math.PI,false)}else{if(this.clip_shape.type==Shape.TypePolygon){var j=e.vertices;var d=j.length;a.moveTo(j[0],j[1]);for(var c=2;c<d;c+=2){a.lineTo(j[c],j[c+1])}a.closePath()}}}}a.clip()}var h=this.actors;var d=h.length;for(var k=0;k<d;k++){h[k].draw()}if(this.clip_children){a.restore()}};Scene.prototype.baseUpdate=function(e){if(!this.active){return false}if(this.onTick!==undefined){this.onTick(e)}this.timelines.update(e);this.updateCamera(e);if(this.world!=null){var f=window.app;if(this.time_step==0){this.world.Step(e,10,10)}else{var b=1;if(f.adaptive_physics){b=(f.target_frame_rate/f.avg_fps+0.5)<<0;if(b<1){b=1}else{if(b>3){b=3}}}for(var c=0;c<b;c++){this.world.Step(this.time_step,10,10)}}}var a=this.actors;var d=a.length;for(var c=0;c<d;c++){a[c].update(e)}if(this.world!=null){this.world.ClearForces()}this.frame_count++;this.cleanupDestroyedActors();if(this.order_changed){this.order_changed=false;Utils.sortLayers(this.actors)}return true};Scene.prototype.update=function(a){return this.baseUpdate(a)};Scene.prototype.updateCamera=function(b){if(this.target_x!=null){if(this.follow_speed_x==0){this.camera_x=this.target_x.x;this.camera_vx=0}else{this.camera_vx+=(this.target_x.x-this.camera_x)*this.follow_speed_x}}if(this.target_y!=null){if(this.follow_speed_y==0){this.camera_y=this.target_y.y;this.camera_vy=0}else{this.camera_vy+=(this.target_y.y-this.camera_y)*this.follow_speed_y}}if(!this.touching){this.camera_x+=this.camera_vx*b;this.camera_y+=this.camera_vy*b;this.camera_vx*=0.9;this.camera_vy*=0.9}if(this.camera_x!=0||this.camera_y!=0){var h=this.extents[2];var e=this.extents[3];var j=this.app.canvas_width;var g=this.app.canvas_height;if(h!=0&&j<=h){var f=j/2;var c=this.extents[0]+f;var k=(this.extents[0]+h)-f;if(this.camera_x<c){this.camera_x=c;this.camera_vx=0}if(this.camera_x>k){this.camera_x=k;this.camera_vx=0}}if(j>h){this.camera_x=0}if(e!=0&&g<=e){var d=g/2;var i=this.extents[1]+d;var a=(this.extents[1]+e)-d;if(this.camera_y<i){this.camera_y=i;this.camera_vy=0}if(this.camera_y>a){this.camera_y=a;this.camera_vy=0}}if(g>e){this.camera_y=0}}};Scene.prototype.findHitActor=function(a){var b=this.actors;var d=b.length;var e=null;for(var c=d-1;c>=0;c--){e=b[c].hitTest(a);if(e!=null){return e}}return e};Scene.prototype.dirty=function(){var b=this.actors;var d=b.length;for(var c=0;c<d;c++){b[c].dirty()}};Scene.prototype.getResFromType=function(a){if(a=="brush"){return this.brushes}else{if(a=="sound"){return this.sounds}else{if(a=="shape"){return this.shapes}else{if(a=="material"){return this.materials}else{if(a=="bitmap"){return this.bitmaps}}}}}return null};Scene.prototype.addResource=function(c,b){var a=this.getResFromType(b);if(a!=null){a.push(c);a.parent=this}};Scene.prototype.removeResource=function(e,c){var b=this.getResFromType(c);if(b!=null){var d=b.length;for(var a=0;a<d;a++){if(b[a].name==name){b.parent=null;b.splice(a,1);return}}}};Scene.prototype.findResource=function(a,d){var c=this.getResFromType(d);if(c==null){return null}var e=c.length;for(var b=0;b<e;b++){if(c[b].name==a){return c[b]}}return this.app.findResource(a,d)};Scene.prototype.areResourcesLoaded=function(){var b=this.bitmaps;var c=b.length;for(var a=0;a<c;a++){if(b[a].preload&&!b[a].loaded){return false}}return true};Scene.prototype.countResourcesNeedLoading=function(){var d=0;var b=this.bitmaps;var c=b.length;for(var a=0;a<c;a++){if(b[a].preload){d++}}b=this.sounds;c=b.length;for(a=0;a<c;a++){if(b[a].preload){d++}}return d};"use strict";function Shape(a){this.parent=null;this.name=a;this.type=Shape.TypeBox;this.width=0;this.height=0;this.vertices=[];this.convexVertices=[]}Shape.TypeBox=0;Shape.TypeCircle=1;Shape.TypePolygon=2;Shape.prototype.typeToConst=function(a){if(shape.type=="polygon"){return Shape.TypePolygon}else{if(shape.type=="circle"){return Shape.TypeCircle}}return Shape.TypeBox};Shape.prototype.remove=function(){if(this.parent!=null){this.parent.removeResource(this,"shape")}};"use strict";function Sound(b,a,c){this.parent=null;this.name=b;this.location=a;this.location2=null;this.loop=false;if(c!==undefined){this.reuse=c}else{this.reuse=false}this.snd=null;this.preload=false;this.loaded=false}Sound.prototype.load=function(){var b=window.app.debug;var a;var c=this;if(window.app.use_marm){a=new Media("/android_asset/webassets/"+this.location)}else{a=new Audio();if(this.loop){if(typeof a.loop=="boolean"){a.loop=true}else{a.addEventListener("ended",function(){this.currentTime=0;this.play()},false)}}a.onerror=function(){a.onerror=null;if(c.location2!==null){a.onerror=function(){a.onerror=null;window.app.onResourceLoaded(c,true)};a.src=c.location2;a.play();c.snd=a}else{window.app.onResourceLoaded(c,true)}};a.oncanplaythrough=function(){a.oncanplaythrough=null;window.app.onResourceLoaded(c,false)};a.src=this.location}this.snd=a};Sound.prototype.play=function(){var a=null;if(this.reuse){a=this.snd}if(a==null){if(window.app.use_marm||!this.reuse){this.load()}}if(a!=null){a.play()}return a};Sound.prototype.stop=function(){if(this.reuse&&this.snd!=null){this.snd.stop()}};Sound.prototype.pause=function(){if(this.reuse&&this.snd!=null){this.snd.pause()}};Sound.prototype.destroy=function(){if(this.parent!=null){if(window.app.use_marm){if(window.app.use_marm&&this.snd!=null){this.snd.release()}this.parent.removeResource(this,"sound")}}};"use strict";function Utils(){}Utils.sortLayers=function(e){var b=e.length;var c,a;for(a=0;a<b;a++){for(c=a+1;c<b;c++){if(e[a].layer>e[c].layer){var d=e[a];e[a]=e[c];e[c]=d}}}};"use strict";function Xoml(a){this.current_scene=null;this.app=a}Xoml.loadJSON=function(a,c,d){var b=new XMLHttpRequest();b.open("GET",a,!c);if(!c){b.onreadystatechange=function(){if(b.readyState==4&&b.status==200){d(b.responseText)}else{d(null)}}}b.send();if(c){if(b.status==200){d(b.responseText)}else{d(null)}}};Xoml.loadJS=function(a){var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("src",a);if(typeof b!="undefined"){document.getElementsByTagName("head")[0].appendChild(b)}};Xoml.prototype.parseScene=function(parent,item){if(this.app.debug){console.log("Parsing Scene "+item.Name)}var scene=new Scene();this.current_scene=scene;scene.name=item.Name;if(item.Tag!==undefined){scene.tag=item.Tag}scene.x=item.Position.x;scene.y=item.Position.y;if(item.CanvasSize!==undefined){scene.w=item.CanvasSize.x;scene.h=item.CanvasSize.y}if(item.Layer!==undefined){scene.layer=item.Layer}if(item.Visible!==undefined){scene.visible=item.Visible}if(item.Active!==undefined){scene.active=item.Active}if(item.Physics!==undefined&&item.Physics){scene.initWorld(item.Gravity.x,item.Gravity.y,item.DoSleep);if(item.PhysicsTimestep!==undefined){scene.time_step=item.PhysicsTimestep}if(item.WorldScale!==undefined){scene.world_scale=item.WorldScale}}if(item.ClipChildren!==undefined){scene.clip_children=item.ClipChildren}if(item.TouchPan=="Both"){scene.touch_pan_x=true;scene.touch_pan_y=true}else{if(item.TouchPan=="X"){scene.touch_pan_x=true}else{if(item.TouchPan=="Y"){scene.touch_pan_y=true}}}scene.extents[0]=item.Extents.x;scene.extents[1]=item.Extents.y;scene.extents[2]=item.Extents.w;scene.extents[3]=item.Extents.h;scene.follow_speedx=item.FollowSpeed.x;scene.follow_speedy=item.FollowSpeed.y;if(parent!==null){parent.addScene(scene);if(item.Current){parent.focus_scene=scene}else{if(item.Current2){parent.focus_scene2=scene}}}var user_props=item.UserProps;if(user_props!==undefined){for(var t=0;t<user_props.length;t++){scene[user_props[t].Name]=user_props[t].Value}}var tc=item.TimelineCollection;if(tc!==undefined){for(var t=0;t<tc.length;t++){this.parseTimeline(scene,tc[t])}}if(item.Alpha!==undefined){scene.opacity=item.Alpha}if(!(item.Children===undefined)){this.parseResources(scene,item.Children)}if(item.ClipShape!==undefined&&item.ClipShape!=""){scene.clip_shape=scene.findResource(item.ClipShape,"shape")}if(item.TargetX!=""){scene.target_x=scene.findActor(item.TargetX)}if(item.TargetY!=""){scene.target_y=scene.findActor(item.TargetY)}if(item.OnCreate!==undefined){scene.onCreate=function(){eval(item.OnCreate)}}if(item.OnDestroy!==undefined){scene.onDestroy=function(){eval(item.OnDestroy)}}if(item.OnTick!==undefined){scene.onTick=function(dt){eval(item.OnTick)}}if(item.OnTapped!==undefined){scene.onTapped=function(touch_pos){eval(item.OnTapped)}}if(item.OnBeginTouch!==undefined){scene.onBeginTouch=function(touch_pos){eval(item.OnBeginTouch)}}if(item.OnEndTouch!==undefined){scene.onEndTouch=function(touch_pos){eval(item.OnEndTouch)}}if(item.OnMoveTouch!==undefined){scene.onMoveTouch=function(touch_pos){eval(item.OnMoveTouch)}}if(item.OnKeyPress!==undefined){scene.onKeyPress=function(e){eval(item.OnKeyPress)}}if(item.OnKeyDown!==undefined){scene.onKeyDown=function(e){eval(item.OnKeyDown)}}if(item.OnKeyUp!==undefined){scene.onKeyUp=function(e){eval(item.OnKeyUp)}}if(scene.onCreate!==undefined){scene.onCreate()}return scene};Xoml.prototype.parseBrush=function(g,i){if(this.app.debug){console.log("Parsing Brush "+i.Name)}var c;if(i.BrushType==0){var e=i.Rect;var f=g.findResource(i.Image,"bitmap");var b=i.Frames;if(b.length==0){c=new ImageAtlas(i.Name,f,e.x,e.y,e.w,e.h)}else{c=new ImageAtlas(i.Name,f);for(var j=0;j<b.length;j++){var a=b[j];c.addFrame(a.x,a.y,a.w,a.h)}}}else{var h=i.Stops;c=new Gradient(i.Name);for(var j=0;j<h.length;j++){var d=h[j];c.addColourStop(d.c,d.o)}if(i.Angle!==undefined){c.angle=i.Angle}}g.addResource(c,"brush");return c};Xoml.prototype.parseImage=function(a,b){if(this.app.debug){console.log("Parsing Image "+b.Name)}var c=new Bitmap(b.Name,b.Location,b.Preload);a.addResource(c,"bitmap");return c};Xoml.prototype.parseSound=function(a,b){if(this.app.debug){console.log("Parsing Sound "+b.Name)}var c=new Sound(b.Name,b.Location,b.Reuse);if(b.Preload!==undefined){c.preload=b.Preload}if(b.Location2!==undefined){c.location2=b.Location2}if(b.Loop!==undefined){c.loop=b.Loop}if(c.preload){c.load()}a.addResource(c,"sound");return c};Xoml.prototype.parseFont=function(a,b){if(this.app.debug){console.log("Parsing Font "+b.Name)}};Xoml.prototype.parseShape=function(f,g){if(this.app.debug){console.log("Parsing Shape "+g.Name)}var d=new Shape(g.Name);d.width=g.Width;d.height=g.Height;if(g.ShapeType=="Circle"){d.type=Shape.TypeCircle}else{if(g.ShapeType=="Box"){d.type=Shape.TypeBox}else{if(g.ShapeType=="Polygon"){d.type=Shape.TypePolygon;var c=g.Vertices;var b=c.length;for(var h=0;h<b;h++){d.vertices.push(c[h])}if(g.ConvexVertices!==undefined){var e=g.ConvexVertices.length;for(var h=0;h<e;h++){var a=[];var c=g.ConvexVertices[h];b=c.length;for(var i=0;i<b;i++){a.push(c[i])}d.convexVertices.push(a)}}}}}f.addResource(d,"shape");return d};Xoml.prototype.parseMaterial=function(b,c){if(this.app.debug){console.log("Parsing Material "+c.Name)}var a=new Material();a.name=c.Name;a.type=c.MaterialType;a.density=c.Density;a.friction=c.Friction;a.restitution=c.Restitution;a.gravity_scale=c.GravityScale;a.fixed_rotation=c.FixedRotation;a.is_bullet=c.IsBullet;b.addResource(a,"material");return a};Xoml.prototype.parseTimeline=function(parent,item){var timeline=new Timeline();if(item.Name!==undefined){timeline.name=item.Name}var count=item.Animations.length;for(var t=0;t<count;t++){var animation=item.Animations[t];var anim=new Animation(timeline,parent,animation.Property,animation.Values,animation.Times,0,animation.Ease);if(animation.Tween!==undefined){anim.tween=animation.Tween}if(animation.Destroy!==undefined){anim.destroy=animation.Destroy}if(animation.Repeat!==undefined){anim.repeat=animation.Repeat}anim.repeats_left=anim.repeat;if(animation.TimeScale!==undefined){anim.time_scale=animation.TimeScale}if(animation.Delay!==undefined){anim.time=-animation.Delay}if(animation.AutoPlay==false){anim.pause()}if(animation.OnEnd!==undefined){anim.onEnd=function(){eval(animation.OnEnd)}}if(animation.OnRepeat!==undefined){anim.onRepeat=function(){eval(animation.OnRepeat)}}if(animation.Actions!==undefined){for(var t2=0;t2<animation.Actions.length;t2++){if(animation.Actions[t2]!==""){var act=animation.Actions[t2];anim.setAction(t2,function(){eval(act)})}}}timeline.anims.push(anim)}parent.timelines.add(timeline)};Xoml.prototype.parseActor=function(actor,parent,item){if(this.app.debug){console.log("Parsing Actor "+item.Name)}var brush=null;actor.scene=this.current_scene;if(item.Name!==undefined){actor.name=item.Name}if(item.Tag!==undefined){actor.tag=item.Tag}if(item.Visible!==undefined){actor.visible=item.Visible}if(item.Active!==undefined){actor.active=item.Active}if(item.Layer!==undefined){actor.layer=item.Layer}if(item.Position!==undefined){actor.x=item.Position.x;actor.y=item.Position.y}if(item.Scale!==undefined){actor.scale_x=item.Scale.x;actor.scale_y=item.Scale.y}if(item.FlipX!==undefined&&item.FlipX){actor.scale_x=-actor.scale_x}if(item.FlipY!==undefined&&item.FlipY){actor.scale_y=-actor.scale_y}if(item.Orphan!==undefined){actor.orphaned=item.Orphan}if(item.Angle!==undefined){actor.rotation=item.Angle}if(item.Colour!==undefined){actor.fill_style=item.Colour}if(item.StrokeColour!==undefined){actor.stroke_style=item.StrokeColour}if(item.Filled!==undefined){actor.filled=item.Filled}if(item.Thickness!==undefined){actor.stroke_thickness=item.Thickness}if(item.Size!==undefined){actor.w=item.Size.x;actor.h=item.Size.y}if(item.Origin!==undefined){actor.ox=item.Origin.x;actor.oy=item.Origin.y}if(actor.ox<=-1||actor.ox>=1||actor.oy<=-1||actor.oy>=1){actor.absolute_origin=true}if(item.Alpha!==undefined){actor.opacity=item.Alpha}if(item.UseParentOpacity!==undefined){actor.use_parent_opacity=item.UseParentOpacity}if(item.Depth!==undefined){actor.depth=item.Depth}actor.use_transform=true;if(item.Velocity!==undefined){actor.vx=item.Velocity.x;actor.vy=item.Velocity.y}if(item.AngularVelocity!==undefined){actor.vr=item.AngularVelocity}if(item.VelocityDamping!==undefined){actor.vx_damping=item.VelocityDamping.x;actor.vy_damping=item.VelocityDamping.y}if(item.AngularVelocityDamping!==undefined){actor.vr_damping=item.AngularVelocityDamping}if(item.WrapPosition!==undefined){actor.wrap_position=item.WrapPosition}if(item.IgnoreCamera!==undefined){actor.ignore_camera=item.IgnoreCamera}if(item.ClipChildren!==undefined){actor.clip_children=item.ClipChildren}if(item.Touchable!==undefined){actor.touchable=item.Touchable}if(item.Bubbling!==undefined){actor.bubbling=item.Bubbling}if(item.Docking!==undefined){var docking=item.Docking;if(docking=="top"||docking=="topleft"||docking=="topright"){actor.dock_y=Actor.Dock_Top}else{if(docking=="bottom"||docking=="bottomleft"||docking=="bottomright"){actor.dock_y=Actor.Dock_Bottom}}if(docking=="left"||docking=="topleft"||docking=="bottomleft"){actor.dock_x=Actor.Dock_Left}else{if(docking=="right"||docking=="topright"||docking=="bottomright"){actor.dock_x=Actor.Dock_Right}}}if(item.Margin!==undefined){actor.margin[0]=item.Margin.x;actor.margin[1]=item.Margin.y;actor.margin[2]=item.Margin.w;actor.margin[3]=item.Margin.h}if(item.ClipMargin!==undefined){actor.clip_margin[0]=item.ClipMargin.x;actor.clip_margin[1]=item.ClipMargin.y;actor.clip_margin[2]=item.ClipMargin.w;actor.clip_margin[3]=item.ClipMargin.h}if(item.Shadow!==undefined){actor.shadow=item.Shadow}if(item.ShadowOffset!==undefined){actor.shadow_x=item.ShadowOffset.x;actor.shadow_y=item.ShadowOffset.y}if(item.ShadowBlur!==undefined){actor.shadow_blur=item.ShadowBlur}if(item.ShadowColour!==undefined){actor.shadow_colour=item.ShadowColour}if(item.CompositeOp!==undefined){actor.composite_op=item.CompositeOp}if(item.Frames!==undefined&&item.Frames.length>0){var frames=item.Frames;var count=frames.length;actor.anim_frames=[];for(var t=0;t<count;t++){actor.anim_frames.push(frames[t])}}if(item.AnimSpeed!==undefined){actor.frame_speed=item.AnimSpeed}if(item.StartFrame!==undefined){actor.current_frame=item.StartFrame}if(item.Background!==undefined){brush=this.current_scene.findResource(item.Background,"brush");if(brush.stops!==undefined){var grad=brush.createStyle(actor.w,actor.h,item.GStart,item.GEnd);if(actor.filled){actor.fill_style=grad}else{actor.stroke_style=grad}}else{actor.atlas=brush}}if(parent!==null){parent.addActor(actor)}if(item.OnCreate!==undefined){actor.onCreate=function(){eval(item.OnCreate)}}if(item.OnDestroy!==undefined){actor.onDestroy=function(){eval(item.OnDestroy)}}if(item.OnTick!==undefined){actor.onTick=function(dt){eval(item.OnTick)}}if(item.OnTapped!==undefined){actor.touchable=true;actor.onTapped=function(touch_pos){eval(item.OnTapped)}}if(item.OnBeginTouch!==undefined){actor.touchable=true;actor.onBeginTouch=function(touch_pos){eval(item.OnBeginTouch)}}if(item.OnEndTouch!==undefined){actor.touchable=true;actor.onEndTouch=function(touch_pos){eval(item.OnEndTouch)}}if(item.OnMoveTouch!==undefined){actor.touchable=true;actor.onMoveTouch=function(touch_pos){eval(item.OnMoveTouch)}}if(item.OnLostTouchFocus!==undefined){actor.touchable=true;actor.onLostTouchFocus=function(touch_pos){eval(item.OnLostTouchFocus)}}if(item.OnCollisionStart!==undefined){actor.onCollisionStart=function(contact){eval(item.OnCollisionStart)}}if(item.OnCollisionEnd!==undefined){actor.onCollisionEnd=function(contact){eval(item.OnCollisionEnd)}}var user_props=item.UserProps;if(user_props!==undefined){for(var t=0;t<user_props.length;t++){actor[user_props[t].Name]=user_props[t].Value}}var fixtures=item.Fixtures;if(fixtures!==undefined){for(var t=0;t<fixtures.length;t++){var options={};var material=null;var shape=null;if(fixtures[t].Material!==undefined&&fixtures[t].Material!=""){material=this.current_scene.findResource(fixtures[t].Material,"material")}if(fixtures[t].Shape!==undefined&&fixtures[t].Shape!=""){shape=this.current_scene.findResource(fixtures[t].Shape,"shape")}if(t==0){actor.initBody(material.type,material.fixed_rotation,material.is_bullet)}if(shape==null){if(item.RenderAs==1){options.type=Shape.TypeCircle;options.radius=actor.w/2*actor.scale_x}else{options.type=Shape.TypeBox;options.width=actor.w*actor.scale_x;options.height=actor.h*actor.scale_y}}else{if(shape.type==Shape.TypePolygon){if(shape.convexVertices.length>0){options.convexPoints=[];for(var s=0;s<shape.convexVertices.length;s++){var points=[];var v=shape.convexVertices[s];for(var i=0;i<v.length;i+=2){points.push(v[i]*actor.scale_x);points.push(v[i+1]*actor.scale_y)}options.convexPoints.push(points)}}else{options.points=[];for(var i=0;i<shape.vertices.length;i+=2){options.points.push(shape.vertices[i]*actor.scale_x);options.points.push(shape.vertices[i+1]*actor.scale_y)}}}else{if(shape.type==Shape.TypeCircle){options.radius=shape.width*actor.scale_x}else{options.width=shape.width*actor.scale_x;options.height=shape.height*actor.scale_y}}options.type=shape.type}if(material!=null){options.density=material.density;options.friction=material.friction;options.restitution=material.restitution}options.is_sensor=fixtures[t].Sensor;actor.addFixture(options)}}var joints=item.Joints;if(joints!==undefined){for(var t=0;t<joints.length;t++){var options=[];var actor_b=this.current_scene.findActor(joints[t].ActorB);options.type=joints[t].Type;options.actor_b=actor_b;options.anchor_a=joints[t].OffsetA;options.anchor_b=joints[t].OffsetB;options.self_collide=joints[t].SelfCollide;options.damping=joints[t].Damping;options.frequency=joints[t].Frequency;options.limit_joint=joints[t].LimitJoint;options.lower_limit=joints[t].LowerLimit;options.upper_limit=joints[t].UpperLimit;options.motor_enabled=joints[t].MotorEnabled;options.motor_speed=joints[t].MotorSpeed;options.max_motor_torque=joints[t].MaxMotorTorque;options.max_motor_force=joints[t].MaxMotorForce;options.ground_a=joints[t].GroundA;options.ground_b=joints[t].GroundB;options.axis=joints[t].Axis;options.ratio=joints[t].Ratio;actor.addJoint(options)}}var tc=item.TimelineCollection;if(tc!==undefined){for(var t=0;t<tc.length;t++){this.parseTimeline(actor,tc[t])}}if(actor.body!=null){var b2Vec2=Box2D.Common.Math.b2Vec2;actor.body.SetLinearVelocity(new b2Vec2(actor.vx,actor.vy));actor.body.SetAngularVelocity(actor.vr);actor.body.SetLinearDamping(actor.vx_damping);actor.body.SetAngularDamping(actor.vr_damping)}if(item.Children!==undefined){this.parseResources(actor,item.Children)}return actor};Xoml.prototype.parseIcon=function(d,e){if(this.app.debug){console.log("Parsing Icon "+e.Name)}var c;var b=0;if(e.RenderAs!==undefined){b=e.RenderAs}if(b==1){c=new ArcActor()}else{if(b==2){c=new RectActor()}else{if(b==0){if(e.Geometry!==undefined){c=new PolygonActor();var a=this.current_scene.findResource(e.Geometry,"shape");if(a!=null){c.points=a.vertices}}else{c=new Actor()}}}}if(e.CornerRadius!==undefined){c.corner_radius=e.CornerRadius}this.parseActor(c,d,e);if(b==1){c.radius=c.w/2}if(e.Virtual!==undefined&&e.Virtual){c.makeVirtual();if(e.ScrollRange!==undefined){c.scroll_range[0]=e.ScrollRange.x;c.scroll_range[1]=e.ScrollRange.y;c.scroll_range[2]=e.ScrollRange.w;c.scroll_range[3]=e.ScrollRange.h}if(e.ScrollPos!==undefined){c.scroll_pos_x=e.ScrollPos.x;c.scroll_pos_y=e.ScrollPos.y}}if(e.SelfClip!==undefined){c.self_clip=e.SelfClip}if(e.ClipShape!==undefined){c.clip_shape=this.current_scene.findResource(e.ClipShape,"shape")}if(e.Cache==true){c.cache=true}if(e.Merge==true){c.merge_cache=true}if(c.onCreate!==undefined){c.onCreate()}return c};Xoml.prototype.parseLabel=function(b,c){if(this.app.debug){console.log("Parsing Label "+c.Name)}var a=new LabelActor();a.text=c.Text;a.font=c.Font;a.text_align=c.AlignH;a.text_baseline=c.AlignV;this.parseActor(a,b,c);if(c.Cache==true){a.cache=true}if(c.Merge==true){a.merge_cache=true}if(a.onCreate!==undefined){a.onCreate()}return a};Xoml.prototype.parseResources=function(b,d){var c=d.length;for(var a=0;a<c;a++){this.parseResource(b,d[a])}};Xoml.prototype.parseResource=function(b,c){var a=c.ResourceType;if(a=="Scene"){return this.parseScene(b,c)}else{if(a==="Brush"){return this.parseBrush(b,c)}else{if(a==="Image"){return this.parseImage(b,c)}else{if(a==="Sound"){return this.parseSound(b,c)}else{if(a==="Font"){return this.parseFont(b,c)}else{if(a==="Shape"){return this.parseShape(b,c)}else{if(a==="Material"){return this.parseMaterial(b,c)}else{if(a==="Icon"){return this.parseIcon(b,c)}else{if(a==="Label"){return this.parseLabel(b,c)}}}}}}}}}return null};Xoml.findResource=function(e,a,c){if(e.Children!==undefined){e=e.Children}var d=e.length;for(var b=0;b<d;b++){if(e[b].ResourceType.toLowerCase()===c&&e[b].Name===a){return e[b]}}return null};